<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <script src="../common/import.js"></script>
</head>
<body>
<div id="loginFormApp" style="transform: translateY(50%)">
    <el-container>
        <el-main>
            <el-row type="flex" justify="center">
                <el-col>
                    <div style="text-align: center"><h3>登录</h3></div>
                </el-col>
            </el-row>
            <el-row type="flex" justify="center">
                <el-col :span="6">
                    <el-form ref="loginForm" :model="loginForm" label-width="80px">
                        <el-form-item label="管理员id" prop="managerId" :rules="[{ required:true, message:'请输入管理员id', trigger:'blur'}]">
                            <el-input v-model="loginForm.managerId" placeholder="请输入管理员id"></el-input>
                        </el-form-item>
                        <el-form-item label="密码" prop="password" :rules="[{required:true, message:'请输入密码', trigger:'blur'}]">
                            <el-input type="password" v-model="loginForm.password" placeholder="请输入密码"></el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="login">登录</el-button>
                            <el-button @click="reset">重置</el-button>
                        </el-form-item>
                    </el-form>
                </el-col>
            </el-row>
        </el-main>
    </el-container>
</div>
<script>
    axios.get('../manager/init/canInitAdmin')
        .then(function (result) {
            if (!result.success) {
                return;
            }
            Vue.prototype.$alert('第一次使用，需初始化超级管理员。跳转到初始化页面', '提示', {
                callback: function () {
                    window.location.href = 'initAdmin.html';
                }
            });
        });

    var loginFormApp = new Vue({
        el: '#loginFormApp',
        data: {
            loginForm: {
                managerId: null,
                password: null
            }
        },
        methods: {
            login: function () {
                this.$refs.loginForm.validate(function (valid) {
                    if (!valid) {
                        return;
                    }
                    axios.post('../manager/main/login', loginFormApp.loginForm)
                        .then(function (result) {
                            if (result.success) {
                                window.location.href = 'main.html';
                            } else {
                                Vue.prototype.$message.error(result.message);
                            }
                        });
                });
            },
            reset: function () {
                this.$refs.loginForm.resetFields();
            }
        }
    });
</script>
</body>
</html>